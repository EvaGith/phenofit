V1 <- sum(w)
V2 <- sum(w^2)
V3 <- sum(w^3)
V4 <- sum(w^4)

u  <- sum( w * x) / V1
m2 <- sum( w * (x - u)^2) / V1
m3 <- sum( w * (x - u)^3) / V1
m4 <- sum( w * (x - u)^4) / V1

K2 <- M2 <- V1^2 / (V1^2 - V2) * m2
K3 <- M3 <- V1^3 / (V1^3 - 3*V1*V2 + 2*V3) * m3
M4_up   <- V1^2 * (V1^4 - 3*V1^2*V2 + 2*V1*V3 + 3*V2^2 - 3*V4) * m4 -3*V1^2*(2*V1^2*V2 - 2*V1*V3 - 3*V2^2 + 3*V4) * m2^2
M4_down <- (V1^2 - V2) * (V1^4 - 6*V1^2*V2 + 8*V1*V3 + 3*V2^2 - 6*V4)
M4 <- M4_up / M4_down
K4 <- (V1^2 * (V1^4 - 4*V1*V3 + 3*V2^2) * m4 - 3*V1^2*(V1^4 - 2*V1^2*V2 + 4*V1*V3 - 3*V2^2) * m2^2 ) / M4_down